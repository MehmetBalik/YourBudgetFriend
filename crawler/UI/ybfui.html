<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Your Budget Friend</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        margin: 0;
        padding: 0;
    }

    header {
        background: #0077cc;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 28px;
        font-weight: bold;
    }

    .filter-box {
        background: white;
        padding: 20px;
        margin: 20px auto;
        max-width: 700px;
        border-radius: 10px;
        box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }

    .filter-row {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    label {
        font-weight: bold;
    }

    select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    /* Dual Price Slider */
    .range-slider {
        width: 100%;
        position: relative;
        height: 40px;
        margin-top: 10px;
    }

    .slider-track {
        width: 100%;
        height: 8px;
        background: #d3d3d3;
        border-radius: 5px;
        position: absolute;
        top: 16px;
        z-index: 1;
    }

    .slider-range {
        height: 8px;
        background: #0077cc;
        position: absolute;
        top: 16px;
        border-radius: 5px;
        z-index: 2;
    }

    .range-slider input[type=range] {
        position: absolute;
        width: 100%;
        height: 0;
        -webkit-appearance: none;
        background: none;
        pointer-events: none;
    }

    .range-slider input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 18px;
        width: 18px;
        border-radius: 50%;
        background: #0077cc;
        cursor: pointer;
        pointer-events: all;
        position: relative;
        z-index: 3;
    }

    .price-values {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        margin-top: 8px;
    }

    .results {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px;
        max-width: 1100px;
        margin: auto;
    }

    .item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 6px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .item img {
        width: 100%;
        border-radius: 8px;
        height: 220px;
        object-fit: cover;
        margin-bottom: 10px;
    }

    .item-title {
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 5px;
    }

    .item-price {
        color: #444;
        margin-bottom: 10px;
        font-size: 16px;
    }

    .item a {
        color: #0077cc;
        text-decoration: none;
        font-weight: bold;
        margin-top: auto;
    }

    @media (max-width: 600px) {
        header { font-size: 22px; }
        .item-title { font-size: 16px; }
    }
</style>

</head>
<body>

<header>Your Budget Friend</header>

<div class="filter-box">
    <div class="filter-row">

        <!-- Clothing Type -->
        <label for="type">Clothing Type</label>
        <select id="type">
            <option value="">Any</option>
            <option value="shirt">Shirts</option>
            <option value="pants">Pants</option>
            <option value="jacket">Jackets</option>
            <option value="hoodie">Hoodies</option>
        </select>

        <!-- Sorting -->
        <label>Sort By</label>
        <select id="sort">
            <option value="">None</option>
            <option value="priceAsc">Price: Low → High</option>
            <option value="priceDesc">Price: High → Low</option>
            <option value="nameAsc">Alphabetical: A → Z</option>
            <option value="nameDesc">Alphabetical: Z → A</option>
        </select>

        <!-- Price Range -->
        <label>Price Range</label>
        <div class="range-slider">
            <div class="slider-track"></div>
            <div class="slider-range" id="sliderRange"></div>

            <input type="range" id="minSlider" min="0" max="200" value="0" step="1" oninput="updateSlider()">
            <input type="range" id="maxSlider" min="0" max="200" value="200" step="1" oninput="updateSlider()">
        </div>

        <div class="price-values">
            <span id="minVal">$0</span>
            <span id="maxVal">$200</span>
        </div>

        <!-- Search Button -->
        <button onclick="applyFilters()" style="padding:12px; background:#0077cc; border:none; color:white; border-radius:5px; cursor:pointer;">
            Search
        </button>
    </div>
</div>

<!-- Results -->
<div class="results" id="results"></div>

<script>
let items = [];

async function loadData() {
    try {
        const response = await fetch("clothing_data.json");
        items = await response.json();
    } catch (error) {
        console.log("Waiting for crawler to generate clothing_data.json...");
    }
}

function extractPrice(item) {
    return parseFloat((item.price || "").replace(/[^0-9.]/g, "")) || 0;
}

function updateSlider() {
    let minSlider = document.getElementById("minSlider");
    let maxSlider = document.getElementById("maxSlider");

    let minVal = parseInt(minSlider.value);
    let maxVal = parseInt(maxSlider.value);

    if (minVal > maxVal) {
        [minSlider.value, maxSlider.value] = [maxVal, minVal];
        minVal = parseInt(minSlider.value);
        maxVal = parseInt(maxSlider.value);
    }

    document.getElementById("minVal").innerText = "$" + minVal;
    document.getElementById("maxVal").innerText = "$" + maxVal;

    const percentMin = (minVal / 200) * 100;
    const percentMax = (maxVal / 200) * 100;

    const rangeBar = document.getElementById("sliderRange");
    rangeBar.style.left = percentMin + "%";
    rangeBar.style.right = (100 - percentMax) + "%";
}

function sortItems(list, sortType) {
    if (sortType === "priceAsc") return list.sort((a, b) => extractPrice(a) - extractPrice(b));
    if (sortType === "priceDesc") return list.sort((a, b) => extractPrice(b) - extractPrice(a));
    if (sortType === "nameAsc") return list.sort((a, b) => a.name.localeCompare(b.name));
    if (sortType === "nameDesc") return list.sort((a, b) => b.name.localeCompare(a.name));
    return list;
}

function applyFilters() {
    const type = document.getElementById("type").value.toLowerCase();
    const sortType = document.getElementById("sort").value;

    const minPrice = parseFloat(document.getElementById("minSlider").value);
    const maxPrice = parseFloat(document.getElementById("maxSlider").value);

    const resultsBox = document.getElementById("results");
    resultsBox.innerHTML = "";

    let filtered = items.filter(item => {
        let priceValue = extractPrice(item);

        let typeMatch = type === "" || item.name.toLowerCase().includes(type);
        let minMatch = priceValue >= minPrice;
        let maxMatch = priceValue <= maxPrice;

        return typeMatch && minMatch && maxMatch;
    });

    filtered = sortItems(filtered, sortType);

    if (filtered.length === 0) {
        resultsBox.innerHTML = "<p style='text-align:center;'>No results found.</p>";
        return;
    }

    filtered.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";

        const imgHtml = item.image ? `<img src="${item.image}" alt="Product image">` : "";

        div.innerHTML = `
            ${imgHtml}
            <div class="item-title">${item.name}</div>
            <div class="item-price">${item.price}</div>
            <a href="${item.link}" target="_blank">View Item</a>
        `;

        resultsBox.appendChild(div);
    });
}

loadData();
updateSlider();
</script>

</body>
</html>
